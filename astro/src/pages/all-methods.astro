---
import Layout from '@layouts/Layout.astro'
import Card from '@components/Card.astro'
import {loadQuery} from '@sanity/lib/load-query'
import {ALL_METHODS_QUERY} from '@sanity/sanity.queries'
import type {ALL_METHODS_QUERYResult} from 'sanity.types'
import type {FooterData} from '@components/Footer.astro'

const {data: page} = await loadQuery<ALL_METHODS_QUERYResult>({
  query: ALL_METHODS_QUERY,
})

if (!page) {
  Astro.response.status = 404
  throw new Error('Not found')
}

// Safely normalize methods
const methods = Array.isArray(page.methods) ? page.methods.filter(Boolean) : []

const footerData: FooterData | null = page.footer
  ? {
      overview: (page.footer.overview ?? []) as FooterData['overview'],
      colophon: (page.footer.colophon ?? []) as FooterData['colophon'],
      credits: (page.footer.credits ?? []) as FooterData['credits'],
    }
  : null
const description = page?.metaDescription as string || '';
---

<Layout data={footerData} pageTitle="UX Methods A-Z" description={description}>
  <section class="resource-cards">
    <h1>UX Methods A-Z</h1>
    <ul class="grid">
      {
        methods.length > 0 &&
          methods.map((method) => <Card content={method} size={'compact-card'} />)
      }
    </ul>
  </section>
</Layout>
